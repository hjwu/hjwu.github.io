{{ $pic_set := slice }} <!-- 建立一個新的切片 -->
{{ range .pic_set }}
{{ $res := resources.Get . }}
{{ $url := . }} <!-- 預設為原始 URL -->
{{ if $res }}
{{ $url = $res.RelPermalink }}
{{ end }}
{{ $pic_set = $pic_set | append $url }}
{{ end }}

{{ $caption := .caption | default ""}}
{{ $num_per_row := 3 }}
{{ $max_width := 80 }}

{{ if or (eq (len $pic_set) 2) (eq (len $pic_set) 4) }}
{{ $num_per_row = 2 }}
{{ $max_width = 53 }}
{{ end }}

{{/* Trim the caption length to the first 100 characters */}}
{{ $caption = $caption | truncate 100 "..." }}

<div class="pic-grid" style="width: {{ $max_width }}%">
    <div class="pure-g">
        {{ range $num, $a := $pic_set }}
        {{ $display := "block" }}
        {{ if gt $num 8 }} {{ $display = "none" }} {{ end }}
        <div class="pure-u-1-{{ $num_per_row }}" style="display: {{ $display }};">
            <div class="add-padding">
                {{ if and (eq $num 8) (gt (len $pic_set) 9) }}
                <div class="img-container img-black-filter">
                    <a data-src="{{ $a }}" data-fancybox="gallery" {{ with $caption }} data-caption="{{ . }}" {{ end }}>
                        <div class="more-icon" style="background-image: url('{{ printf " %s"
                            (resources.Get "more-icon.png" ).RelPermalink }}');"></div>
                        <img src="{{ $a }}" alt="pictures" />
                    </a>
                </div>
                {{ else }}
                <div class="img-container">
                    <a data-src="{{ $a }}" data-fancybox="gallery" data-caption="{{ $caption }}">
                        <img src="{{ $a }}" alt="pictures" />
                    </a>
                </div>
                {{ end }}
            </div>
        </div>
        {{ end }}
    </div>
</div>